<!DOCTYPE html>
<html>
<head>
  <style>
    body {
      font-family: Inter, sans-serif;
      padding: 20px;
    }
    .container {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    .search-container {
      display: flex;
      gap: 8px;
    }
    input[type="text"] {
      flex: 1;
      padding: 8px;
      border: 1px solid #e5e5e5;
      border-radius: 4px;
    }
    button {
      padding: 8px 16px;
      background: #18A0FB;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    button:hover {
      background: #0D8DE3;
    }
    #csvUpload {
      display: none;
    }
    .error {
      color: #F24822;
      font-size: 12px;
      margin-top: 4px;
    }
    .log {
      margin-top: 16px;
      padding: 8px;
      background: #f5f5f5;
      border-radius: 4px;
      font-size: 12px;
      max-height: 300px;
      overflow-y: auto;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="search-container">
      <input type="text" id="search" placeholder="Search recipes...">
      <button id="searchBtn">Search</button>
    </div>
    <input type="file" id="csvUpload" accept=".csv">
    <button id="uploadBtn">Upload CSV</button>
    <div id="error" class="error"></div>
    <div id="log" class="log"></div>
  </div>

  <script>
    let csvData = null;

    function log(message) {
      const logElement = document.getElementById('log');
      logElement.innerHTML += `${message}<br>`;
      logElement.scrollTop = logElement.scrollHeight;
    }

    function showError(message) {
      const errorElement = document.getElementById('error');
      errorElement.textContent = message;
    }

    document.getElementById('searchBtn').onclick = () => {
      const searchQuery = document.getElementById('search').value.trim();
      if (!searchQuery) {
        showError('Please enter a search query');
        return;
      }
      if (!csvData) {
        showError('Please upload a CSV file first');
        return;
      }
      parent.postMessage({ 
        pluginMessage: { 
          type: 'search-recipes', 
          query: searchQuery,
          csvData: csvData
        } 
      }, '*');
    };

    document.getElementById('uploadBtn').onclick = () => {
      document.getElementById('csvUpload').click();
    };

    document.getElementById('csvUpload').onchange = (event) => {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = (e) => {
          csvData = e.target.result;
          log('CSV file loaded successfully');
          log(`CSV Data size: ${csvData.length} characters`);
          showError('');
        };
        reader.onerror = () => {
          showError('Error reading CSV file. Please try again.');
          log('Error: Failed to read CSV file from user upload.');
        };
        reader.readAsText(file);
      }
    };

    // Listen for messages from the plugin code
    window.onmessage = (event) => {
      const message = event.data.pluginMessage;
      if (message.type === 'log') {
        log(message.message);
      } else if (message.type === 'error') {
        showError(`Error: ${message.message}`);
      }
    };
  </script>
</body>
</html>
